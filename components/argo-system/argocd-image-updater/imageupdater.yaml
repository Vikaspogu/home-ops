---
apiVersion: argocd-image-updater.argoproj.io/v1alpha1
kind: ImageUpdater
metadata:
  name: gitea-apps
  namespace: argo-system
spec:
  namespace: argo-system
  commonUpdateSettings:
    updateStrategy: latest
    ignoreTags:
      - latest
  writeBackConfig:
    method: "git:secret:argo-system/git-creds"
    gitConfig:
      branch: main
  applicationRefs:
    - namePattern: "mo"
      writeBackConfig:
        method: "git:secret:argo-system/git-creds"
        gitConfig:
          branch: main
          writeBackTarget: "helmvalues:./values.yaml"
      images:
        - alias: mo
          imageName: "gitea.omv.${CLUSTER_DOMAIN}/vpogu/mo-agent"
          commonUpdateSettings:
            allowTags: 'regexp:^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-f0-9]{7}'
          manifestTargets:
            helm:
              name: controllers.app.containers.main.image.repository
              tag: controllers.app.containers.main.image.tag
    - namePattern: "tripnibble"
      writeBackConfig:
        method: "git:secret:argo-system/git-creds"
        gitConfig:
          branch: main
          writeBackTarget: "helmvalues:./values.yaml"
      images:
        - alias: tn-nat
          imageName: "gitea.omv.${CLUSTER_DOMAIN}/vpogu/tripnibble"
          commonUpdateSettings:
            allowTags: 'regexp:^[a-f0-9]{7,40}'
          manifestTargets:
            helm:
              name: controllers.nat.containers.main.image.repository
              tag: controllers.nat.containers.main.image.tag
        - alias: tn-chainlit
          imageName: "gitea.omv.${CLUSTER_DOMAIN}/vpogu/tripnibble"
          commonUpdateSettings:
            allowTags: 'regexp:^[a-f0-9]{7,40}'
          manifestTargets:
            helm:
              name: controllers.chainlit.containers.main.image.repository
              tag: controllers.chainlit.containers.main.image.tag
