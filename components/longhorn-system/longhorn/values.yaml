# Optimized for 1-2 node cluster
longhorn:
  # CSI controller replicas - keep at 1 for small clusters
  replicas: 1

csi:
  attacher:
    replicas: 1
  provisioner:
    replicas: 1
  resizer:
    replicas: 1
  snapshotter:
    replicas: 1
  attacherReplicaCount: 2
  provisionerReplicaCount: 2
  resizerReplicaCount: 2
  snapshotterReplicaCount: 2

defaultSettings:
  autoCleanupSnapshotAfterOnDemandBackupCompleted: true
  autoCleanupSnapshotWhenDeleteBackup: true
  concurrentAutomaticEngineUpgradePerNodeLimit: 1
  concurrentReplicaRebuildPerNodeLimit: 3
  concurrentVolumeBackupRestorePerNodeLimit: 3
  createDefaultDiskLabeledNodes: true
  defaultDataLocality: best-effort
  defaultLonghornStaticStorageClass: longhorn
  defaultReplicaCount: 2 # TODO: Increase this to 2-3 when adding nodes
  detachManuallyAttachedVolumesWhenCordoned: true
  #guaranteedEngineManagerCPU: 20
  #guaranteedReplicaManagerCPU: 20
  node-drain-policy: allow-if-replica-is-stopped
  #nodeDownPodDeletionPolicy: delete-both-statefulset-and-deployment-pod
  offlineRelicaRebuilding: true
  orphanAutoDeletion: true
  replicaAutoBalance: best-effort
  restoreVolumeRecurringJobs: true # Don´t need this if we create a default one and then use localpath for the ones we don´t want to backup
  # snapshotMaxCount: 10
  storageReservedPercentageForDefaultDisk: 0
  storageMinimalAvailablePercentage: 5
  storageOverProvisioningPercentage: 150
  defaultDataPath: "/srv/dev-disk-by-uuid-e486bb32-3762-4f61-bfeb-3d3b626159e8/longhorn"
  defaultClassReplicaCount: 1

preUpgradeChecker:
  jobEnabled: false

persistence:
  defaultClass: true
  defaultClassReplicaCount: 1
  reclaimPolicy: Delete
  backupTargetName: default

# Resource limits for small clusters
longhornManager:
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

longhornDriver:
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
longhornUI:
  replicas: 1
annotations:
  configmap.reloader.stakater.com/reload: longhorn-default-setting
ingress:
  enabled: false
