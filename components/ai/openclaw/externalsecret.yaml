---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: openclaw
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: openclaw-secret
    template:
      engineVersion: v2
      data:
        # Environment variables for skills
        GITHUB_TOKEN: "{{ .GITHUB_TOKEN }}"
        OPENCLAW_GATEWAY_TOKEN: "{{ .OPENCLAW_GATEWAY_TOKEN }}"
        # GOOGLE_CLIENT_ID: "{{ .GOOGLE_CLIENT_ID }}"
        # GOOGLE_CLIENT_SECRET: "{{ .GOOGLE_CLIENT_SECRET }}"
  dataFrom:
    - extract:
        key: openclaw
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: openclaw-config-json
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: openclaw-config-json
    template:
      engineVersion: v2
      data:
        # OpenClaw openclaw.json - mounted as file
        openclaw.json: |
          {
            "agents": {
              "defaults": {
                "model": {
                  "primary": "ollama/gpt-oss:120b"
                },
                "workspace": "/home/node/.openclaw/workspace"
              }
            },
            "models": {
              "providers": {
                "ollama": {
                  "baseUrl": "http://{{ .OLLAMA_URL }}:11434/v1",
                  "models": [
                    {
                      "id": "gpt-oss:120b",
                      "name": "GPT-OSS 120B",
                      "reasoning": false,
                      "input": ["text"],
                      "cost": { "input": 0, "output": 0 },
                      "contextWindow": 131072,
                      "maxTokens": 16384
                    }
                  ]
                }
              }
            },
            "gateway": {
              "port": 18789,
              "bind": "lan",
              "trustedProxies": ["10.69.0.0/16"],
              "auth": {
                "token": "{{ .OPENCLAW_GATEWAY_TOKEN }}",
                "rateLimit": {
                  "maxAttempts": 10,
                  "windowMs": 60000,
                  "lockoutMs": 300000
                }
              },
              "controlUi": {
                "enabled": true,
                "allowInsecureAuth": true
              }
            }
          }
  dataFrom:
    - extract:
        key: openclaw
