controllers:
  main:
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 17.6.0@sha256:86a1992d46273c58fd4ad95b626081dfaabfe16bd56944675169e406d1a660dd
        envFrom: &envFrom
          - secretRef:
              name: memos-secret
    containers:
      main:
        image:
          repository: ghcr.io/usememos/memos
          tag: 0.25.1@sha256:f1faf27fb60aff4df13fc2c6017baa7b6f8ea684dc9a9bff6f212a01d2efe108
        env:
          MEMOS_PORT: "5230"
          MEMOS_DRIVER: postgres
          MEMOS_DSN: postgresql://memos:${SECRET_MEMOS_DB_PASSWORD}@memos-postgresql-primary:5432/memos?sslmode=disable
          MEMOS_PUBLIC: false
          MEMOS_PASSWORD_AUTH: true
        envFrom: *envFrom
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
          startup:
            enabled: true
service:
  main:
    controller: main
    ports:
      http:
        port: 5230
