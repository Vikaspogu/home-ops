---
controllers:
  app:
    pod:
      annotations:
        reloader.stakater.com/auto: "true"
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        fsGroup: 1000
        fsGroupChangePolicy: OnRootMismatch
    containers:
      app:
        image:
          repository: ghcr.io/papra-hq/papra
          tag: 0.9.6-rootless
        env:
          TZ: America/New_York
          TRUSTED_ORIGINS: 'https://papra.${CLUSTER_DOMAIN}/'
          APP_BASE_URL: 'https://papra.${CLUSTER_DOMAIN}'
          DOCUMENT_STORAGE_DRIVER: 'filesystem'
          AUTH_IS_REGISTRATION_ENABLED: false
          DATABASE_URL: file:/app/app-data/db.sqlite
          DOCUMENTS_OCR_LANGUAGES: eng
          DOCUMENT_STORAGE_FILESYSTEM_ROOT: /documents
        envFrom: &envFrom
          - secretRef:
              name: papra-secret
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
          startup:
            enabled: true
        resources:
          requests:
            cpu: 50m
            memory: 1Gi
          limits:
            memory: 2Gi

service:
  app:
    ports:
      http:
        port: &port 1221

persistence:
  data:
    existingClaim: papra
    advancedMounts:
      app:
        app:
          - path: /app/app-data
  media:
    enabled: true
    globalMounts:
      - path: /documents
    type: nfs
    server: ${SECRET_NAS_ADDRESS}
    path: "/volume1/media/k8s-data/papra"
