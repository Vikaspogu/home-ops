---
controllers:
  app:
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 17.6.0@sha256:86a1992d46273c58fd4ad95b626081dfaabfe16bd56944675169e406d1a660dd
        envFrom: &envFrom
          - secretRef:
              name: donetick-secret
    pod:
      annotations:
        reloader.stakater.com/auto: "true"
    containers:
      donetick:
        image:
          repository: donetick/donetick
          tag: v0.1.64
        env:
          TZ: America/New_York
        envFrom: *envFrom
        probes:
          liveness: &probes
            enabled: true
            custom: true
            spec:
              httpGet:
                path: /api/v1/ping
                port: &port 2021
              initialDelaySeconds: 10
              periodSeconds: 60
              timeoutSeconds: 10
              failureThreshold: 3
          readiness: *probes
        resources:
          requests:
            cpu: 50m
            memory: 512Mi
          limits:
            memory: 1Gi

service:
  app:
    controller: app
    ports:
      http:
        port: *port

persistence:
  config:
    type: configMap
    name: donetick-config
    globalMounts:
      - path: "/config/selfhosted.yaml"
        subPath: selfhosted.yaml
        readOnly: true
ingress:
  app:
    enabled: true
    className: internal
    annotations:
      gethomepage.dev/enabled: "true"
      gethomepage.dev/group: Ingress
      gethomepage.dev/icon: donetick.png
    hosts:
      - host: &host "donetick.${CLUSTER_DOMAIN}"
        paths:
          - path: /
            pathType: Prefix
            service:
              identifier: app
              port: http
    tls:
      - hosts:
          - *host
