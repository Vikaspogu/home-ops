---
controllers:
  nat:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      main:
        image:
          repository: gitea.omv.${CLUSTER_DOMAIN}/vpogu/tripnibble
          tag: 4a54f1187475b95f3ae0aac4b4c7c1d7c3bbd59d
        env:
          TZ: America/New_York
          OAUTH_AUTHENTIK_DOMAIN: "id.${CLUSTER_DOMAIN}"
          CHAINLIT_URL: "https://tripnibble.${CLUSTER_DOMAIN}"
        envFrom:
          - secretRef:
              name: tripnibble-secret
        resources:
          requests:
            cpu: 100m
            memory: 512Mi
          limits:
            memory: 2Gi
    pod:
      imagePullSecrets:
        - name: tripnibble-registry-secret
  chainlit:
    annotations:
      reloader.stakater.com/auto: "true"
    containers:
      main:
        image:
          repository: gitea.omv.${CLUSTER_DOMAIN}/vpogu/tripnibble
          tag: 4a54f1187475b95f3ae0aac4b4c7c1d7c3bbd59d
        command:
          - chainlit
          - run
          - /app/chainlit-ui/app.py
          - --host
          - "0.0.0.0"
          - --port
          - "7001"
        env:
          TZ: America/New_York
          NAT_API_URL: http://tripnibble-nat.default.svc.cluster.local:8000
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            memory: 1Gi
    pod:
      imagePullSecrets:
        - name: tripnibble-registry-secret

service:
  nat:
    controller: nat
    ports:
      http:
        port: 8000
  chainlit:
    controller: chainlit
    ports:
      http:
        port: 7001
