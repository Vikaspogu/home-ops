---
controllers:
  app:
    pod:
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        fsGroupChangePolicy: "OnRootMismatch"
        supplementalGroups:
          - 100
    annotations:
      reloader.stakater.com/auto: "true"
    initContainers:
      init-db:
        image:
          repository: ghcr.io/home-operations/postgres-init
          tag: 18.1.0@sha256:3c54d39f19fdb82ed5b3f286450e4071133cc6025bd0e25856bc2c522f8fc030
        envFrom: &envFrom
          - secretRef:
              name: home-assistant-secret
    containers:
      app:
        image:
          repository: ghcr.io/home-operations/home-assistant
          tag: 2026.1.1@sha256:4dbdda39034b3f859ea6dc961bb12d4ccc7046a30738af8b1c2bb3188a7d6617
        env:
          TZ: "America/New_York"
        probes:
          liveness:
            enabled: false
          readiness:
            enabled: false
          startup:
            enabled: false
        resources:
          requests:
            cpu: 100m
            memory: 500Mi
          limits:
            memory: 2500Mi
      codeserver:
        image:
          repository: ghcr.io/coder/code-server
          tag: 4.108.0@sha256:2956e005c038f3d050886163b290adf0cad38cc7605435a1038f4b4b5b3dc5c8
          pullPolicy: IfNotPresent
        env:
          TZ: "America/New_York"
        args:
          - --user-data-dir
          - "/config/.vscode"
          - --auth
          - "none"
          - --port
          - "12321"
          - "/config"

service:
  app:
    ports:
      http:
        port: 8123
  codeserver:
    type: ClusterIP
    ports:
      http:
        enabled: true
        port: 12321
        protocol: TCP
        targetPort: 12321

persistence:
  config:
    enabled: true
    existingClaim: home-assistant
